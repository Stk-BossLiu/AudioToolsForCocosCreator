"use strict";var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var n=function(){return n=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},n.apply(this,arguments)};function i(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))}function r(t,e){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}"function"==typeof SuppressedError&&SuppressedError;var o=function(){function t(){this.listeners={}}return t.prototype.on=function(t,e,n){var i=this;if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null==n?void 0:n.once){var r=function(){i.un(t,r),i.un(t,e)};return this.on(t,r),r}return function(){return i.un(t,e)}},t.prototype.un=function(t,e){var n;null===(n=this.listeners[t])||void 0===n||n.delete(e)},t.prototype.once=function(t,e){return this.on(t,e,{once:!0})},t.prototype.unAll=function(){this.listeners={}},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.listeners[t]&&this.listeners[t].forEach((function(t){return t.apply(void 0,e)}))},t}(),s=function(t){function n(e){var n=t.call(this)||this;return n.subscriptions=[],n.options=e,n}return e(n,t),n.prototype.onInit=function(){},n.prototype._init=function(t){this.wavesurfer=t,this.onInit()},n.prototype.destroy=function(){this.emit("destroy"),this.subscriptions.forEach((function(t){return t()}))},n}(o);var a={decode:function(t,e){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){return n=new AudioContext({sampleRate:e}),[2,n.decodeAudioData(t).finally((function(){return n.close()}))]}))}))},createBuffer:function(t,e){return"number"==typeof t[0]&&(t=[t]),function(t){var e=t[0];if(e.some((function(t){return t>1||t<-1}))){for(var n=e.length,i=0,r=0;r<n;r++){var o=Math.abs(e[r]);o>i&&(i=o)}for(var s=0,a=t;s<a.length;s++){var u=a[s];for(r=0;r<n;r++)u[r]/=i}}}(t),{duration:e,length:t[0].length,sampleRate:t[0].length/e,numberOfChannels:t.length,getChannelData:function(e){return null==t?void 0:t[e]},copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function u(t,e){for(var n=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t),i=0,r=Object.entries(e);i<r.length;i++){var o=r[i],s=o[0],a=o[1];if("children"===s)for(var c=0,l=Object.entries(e);c<l.length;c++){var h=l[c],p=h[0],d=h[1];"string"==typeof d?n.appendChild(document.createTextNode(d)):n.appendChild(u(p,d))}else"style"===s?Object.assign(n.style,a):"textContent"===s?n.textContent=a:n.setAttribute(s,a.toString())}return n}function c(t,e,n){var i=u(t,e||{});return null==n||n.appendChild(i),i}var l=Object.freeze({__proto__:null,createElement:c,default:c});var h={fetchBlob:function(t,e,n){return i(this,void 0,void 0,(function(){var o;return r(this,(function(s){switch(s.label){case 0:return[4,fetch(t,n)];case 1:if((o=s.sent()).status>=400)throw new Error("Failed to fetch ".concat(t,": ").concat(o.status," (").concat(o.statusText,")"));return function(t,e){i(this,void 0,void 0,(function(){var n,o,s,a,u,c=this;return r(this,(function(l){return t.body&&t.headers?(n=t.body.getReader(),o=Number(t.headers.get("Content-Length"))||0,s=0,a=function(t){return i(c,void 0,void 0,(function(){var n;return r(this,(function(i){return s+=(null==t?void 0:t.length)||0,n=Math.round(s/o*100),e(n),[2]}))}))},(u=function(){return i(c,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n.read()];case 1:return t=e.sent(),[3,3];case 2:return e.sent(),[2];case 3:return t.done?[3,5]:(a(t.value),[4,u()]);case 4:e.sent(),e.label=5;case 5:return[2]}}))}))})(),[2]):[2]}))}))}(o.clone(),e),[2,o.blob()]}}))}))}},p=function(t){function n(e){var n=t.call(this)||this;return n.isExternalMedia=!1,e.media?(n.media=e.media,n.isExternalMedia=!0):n.media=document.createElement("audio"),e.mediaControls&&(n.media.controls=!0),e.autoplay&&(n.media.autoplay=!0),null!=e.playbackRate&&n.onMediaEvent("canplay",(function(){null!=e.playbackRate&&(n.media.playbackRate=e.playbackRate)}),{once:!0}),n}return e(n,t),n.prototype.onMediaEvent=function(t,e,n){var i=this;return this.media.addEventListener(t,e,n),function(){return i.media.removeEventListener(t,e,n)}},n.prototype.getSrc=function(){return this.media.currentSrc||this.media.src||""},n.prototype.revokeSrc=function(){var t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)},n.prototype.canPlayType=function(t){return""!==this.media.canPlayType(t)},n.prototype.setSrc=function(t,e){var n=this.getSrc();if(!t||n!==t){this.revokeSrc();var i=e instanceof Blob&&(this.canPlayType(e.type)||!t)?URL.createObjectURL(e):t;try{this.media.src=i}catch(e){this.media.src=t}}},n.prototype.destroy=function(){this.media.pause(),this.isExternalMedia||(this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())},n.prototype.setMediaElement=function(t){this.media=t},n.prototype.play=function(){return i(this,void 0,void 0,(function(){return r(this,(function(t){return[2,this.media.play()]}))}))},n.prototype.pause=function(){this.media.pause()},n.prototype.isPlaying=function(){return!this.media.paused&&!this.media.ended},n.prototype.setTime=function(t){this.media.currentTime=t},n.prototype.getDuration=function(){return this.media.duration},n.prototype.getCurrentTime=function(){return this.media.currentTime},n.prototype.getVolume=function(){return this.media.volume},n.prototype.setVolume=function(t){this.media.volume=t},n.prototype.getMuted=function(){return this.media.muted},n.prototype.setMuted=function(t){this.media.muted=t},n.prototype.getPlaybackRate=function(){return this.media.playbackRate},n.prototype.isSeeking=function(){return this.media.seeking},n.prototype.setPlaybackRate=function(t,e){null!=e&&(this.media.preservesPitch=e),this.media.playbackRate=t},n.prototype.getMediaElement=function(){return this.media},n.prototype.setSinkId=function(t){return this.media.setSinkId(t)},n}(o);var d=function(t){function o(e,n){var i=t.call(this)||this;i.timeouts=[],i.isScrollable=!1,i.audioData=null,i.resizeObserver=null,i.lastContainerWidth=0,i.isDragging=!1,i.subscriptions=[],i.subscriptions=[],i.options=e;var r=i.parentFromOptionsContainer(e.container);i.parent=r;var o=i.initHtml(),s=o[0],a=o[1];return r.appendChild(s),i.container=s,i.scrollContainer=a.querySelector(".scroll"),i.wrapper=a.querySelector(".wrapper"),i.canvasWrapper=a.querySelector(".canvases"),i.progressWrapper=a.querySelector(".progress"),i.cursor=a.querySelector(".cursor"),n&&a.appendChild(n),i.initEvents(),i}return e(o,t),o.prototype.parentFromOptionsContainer=function(t){var e;if("string"==typeof t?e=document.querySelector(t):t instanceof HTMLElement&&(e=t),!e)throw new Error("Container not found");return e},o.prototype.initEvents=function(){var t=this,e=function(e){var n=t.wrapper.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top;return[i/n.width,r/n.height]};if(this.wrapper.addEventListener("click",(function(n){var i=e(n),r=i[0],o=i[1];t.emit("click",r,o)})),this.wrapper.addEventListener("dblclick",(function(n){var i=e(n),r=i[0],o=i[1];t.emit("dblclick",r,o)})),!0!==this.options.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.scrollContainer.addEventListener("scroll",(function(){var e=t.scrollContainer,n=e.scrollLeft,i=e.scrollWidth,r=e.clientWidth,o=n/i,s=(n+r)/i;t.emit("scroll",o,s,n,n+r)})),"function"==typeof ResizeObserver){var n=this.createDelay(100);this.resizeObserver=new ResizeObserver((function(){n().then((function(){return t.onContainerResize()})).catch((function(){}))})),this.resizeObserver.observe(this.scrollContainer)}},o.prototype.onContainerResize=function(){var t=this.parent.clientWidth;t===this.lastContainerWidth&&"auto"!==this.options.height||(this.lastContainerWidth=t,this.reRender())},o.prototype.initDrag=function(){var t=this;this.subscriptions.push(function(t,e,n,i,r,o,s){if(void 0===r&&(r=3),void 0===o&&(o=0),void 0===s&&(s=100),!t)return function(){};var a=matchMedia("(pointer: coarse)").matches,u=function(){},c=function(c){if(c.button===o){c.preventDefault(),c.stopPropagation();var l=c.clientX,h=c.clientY,p=!1,d=Date.now(),f=function(i){if(i.preventDefault(),i.stopPropagation(),!(a&&Date.now()-d<s)){var o=i.clientX,u=i.clientY,c=o-l,f=u-h;if(p||Math.abs(c)>r||Math.abs(f)>r){var v=t.getBoundingClientRect(),m=v.left,y=v.top;p||(null==n||n(l-m,h-y),p=!0),e(c,f,o-m,u-y),l=o,h=u}}},v=function(e){if(p){var n=e.clientX,r=e.clientY,o=t.getBoundingClientRect(),s=o.left,a=o.top;null==i||i(n-s,r-a)}u()},m=function(t){t.relatedTarget&&t.relatedTarget!==document.documentElement||v(t)},y=function(t){p&&(t.stopPropagation(),t.preventDefault())},g=function(t){p&&t.preventDefault()};document.addEventListener("pointermove",f),document.addEventListener("pointerup",v),document.addEventListener("pointerout",m),document.addEventListener("pointercancel",m),document.addEventListener("touchmove",g,{passive:!1}),document.addEventListener("click",y,{capture:!0}),u=function(){document.removeEventListener("pointermove",f),document.removeEventListener("pointerup",v),document.removeEventListener("pointerout",m),document.removeEventListener("pointercancel",m),document.removeEventListener("touchmove",g),setTimeout((function(){document.removeEventListener("click",y,{capture:!0})}),10)}}};return t.addEventListener("pointerdown",c),function(){u(),t.removeEventListener("pointerdown",c)}}(this.wrapper,(function(e,n,i){t.emit("drag",Math.max(0,Math.min(1,i/t.wrapper.getBoundingClientRect().width)))}),(function(e){t.isDragging=!0,t.emit("dragstart",Math.max(0,Math.min(1,e/t.wrapper.getBoundingClientRect().width)))}),(function(e){t.isDragging=!1,t.emit("dragend",Math.max(0,Math.min(1,e/t.wrapper.getBoundingClientRect().width)))})))},o.prototype.getHeight=function(t,e){var n,i=(null===(n=this.audioData)||void 0===n?void 0:n.numberOfChannels)||1;if(null==t)return 128;if(!isNaN(Number(t)))return Number(t);if("auto"===t){var r=this.parent.clientHeight||128;return(null==e?void 0:e.every((function(t){return!t.overlay})))?r/i:r}return 128},o.prototype.initHtml=function(){var t=document.createElement("div"),e=t.attachShadow({mode:"open"}),n=this.options.cspNonce&&"string"==typeof this.options.cspNonce?this.options.cspNonce.replace(/"/g,""):"";return e.innerHTML="\n      <style".concat(n?' nonce="'.concat(n,'"'):"",">\n        :host {\n          user-select: none;\n          min-width: 1px;\n        }\n        :host audio {\n          display: block;\n          width: 100%;\n        }\n        :host .scroll {\n          overflow-x: auto;\n          overflow-y: hidden;\n          width: 100%;\n          position: relative;\n        }\n        :host .noScrollbar {\n          scrollbar-color: transparent;\n          scrollbar-width: none;\n        }\n        :host .noScrollbar::-webkit-scrollbar {\n          display: none;\n          -webkit-appearance: none;\n        }\n        :host .wrapper {\n          position: relative;\n          overflow: visible;\n          z-index: 2;\n        }\n        :host .canvases {\n          min-height: ").concat(this.getHeight(this.options.height,this.options.splitChannels),'px;\n        }\n        :host .canvases > div {\n          position: relative;\n        }\n        :host canvas {\n          display: block;\n          position: absolute;\n          top: 0;\n          image-rendering: pixelated;\n        }\n        :host .progress {\n          pointer-events: none;\n          position: absolute;\n          z-index: 2;\n          top: 0;\n          left: 0;\n          width: 0;\n          height: 100%;\n          overflow: hidden;\n        }\n        :host .progress > div {\n          position: relative;\n        }\n        :host .cursor {\n          pointer-events: none;\n          position: absolute;\n          z-index: 5;\n          top: 0;\n          left: 0;\n          height: 100%;\n          border-radius: 2px;\n        }\n      </style>\n\n      <div class="scroll" part="scroll">\n        <div class="wrapper" part="wrapper">\n          <div class="canvases" part="canvases"></div>\n          <div class="progress" part="progress"></div>\n          <div class="cursor" part="cursor"></div>\n        </div>\n      </div>\n    '),[t,e]},o.prototype.setOptions=function(t){if(this.options.container!==t.container){var e=this.parentFromOptionsContainer(t.container);e.appendChild(this.container),this.parent=e}!0!==t.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.options=t,this.reRender()},o.prototype.getWrapper=function(){return this.wrapper},o.prototype.getWidth=function(){return this.scrollContainer.clientWidth},o.prototype.getScroll=function(){return this.scrollContainer.scrollLeft},o.prototype.setScroll=function(t){this.scrollContainer.scrollLeft=t},o.prototype.setScrollPercentage=function(t){var e=this.scrollContainer.scrollWidth*t;this.setScroll(e)},o.prototype.destroy=function(){var t,e;this.subscriptions.forEach((function(t){return t()})),this.container.remove(),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),null===(e=this.unsubscribeOnScroll)||void 0===e||e.call(this)},o.prototype.createDelay=function(t){var e,n;void 0===t&&(t=10);var i=function(){e&&clearTimeout(e),n&&n()};return this.timeouts.push(i),function(){return new Promise((function(r,o){i(),n=o,e=setTimeout((function(){e=void 0,n=void 0,r()}),t)}))}},o.prototype.convertColorValues=function(t){if(!Array.isArray(t))return t||"";if(t.length<2)return t[0]||"";var e=document.createElement("canvas"),n=e.getContext("2d"),i=e.height*(window.devicePixelRatio||1),r=n.createLinearGradient(0,0,0,i),o=1/(t.length-1);return t.forEach((function(t,e){var n=e*o;r.addColorStop(n,t)})),r},o.prototype.getPixelRatio=function(){return Math.max(1,window.devicePixelRatio||1)},o.prototype.renderBarWaveform=function(t,e,n,i){var r=t[0],o=t[1]||t[0],s=r.length,a=n.canvas,u=a.width,c=a.height,l=c/2,h=this.getPixelRatio(),p=e.barWidth?e.barWidth*h:1,d=e.barGap?e.barGap*h:e.barWidth?p/2:0,f=e.barRadius||0,v=u/(p+d)/s,m=f&&"roundRect"in n?"roundRect":"rect";n.beginPath();for(var y=0,g=0,b=0,C=0;C<=s;C++){var w=Math.round(C*v);if(w>y){var S=Math.round(g*l*i),E=S+Math.round(b*l*i)||1,P=l-S;"top"===e.barAlign?P=0:"bottom"===e.barAlign&&(P=c-E),n[m](y*(p+d),P,p,E,f),y=w,g=0,b=0}var M=Math.abs(r[C]||0),k=Math.abs(o[C]||0);M>g&&(g=M),k>b&&(b=k)}n.fill(),n.closePath()},o.prototype.renderLineWaveform=function(t,e,n,i){var r=function(e){var r=t[e]||t[0],o=r.length,s=n.canvas.height/2,a=n.canvas.width/o;n.moveTo(0,s);for(var u=0,c=0,l=0;l<=o;l++){var h=Math.round(l*a);if(h>u){var p=s+(Math.round(c*s*i)||1)*(0===e?-1:1);n.lineTo(u,p),u=h,c=0}var d=Math.abs(r[l]||0);d>c&&(c=d)}n.lineTo(u,s)};n.beginPath(),r(0),r(1),n.fill(),n.closePath()},o.prototype.renderWaveform=function(t,e,n){if(n.fillStyle=this.convertColorValues(e.waveColor),e.renderFunction)e.renderFunction(t,n);else{var i=e.barHeight||1;if(e.normalize){var r=Array.from(t[0]).reduce((function(t,e){return Math.max(t,Math.abs(e))}),0);i=r?1/r:1}e.barWidth||e.barGap||e.barAlign?this.renderBarWaveform(t,e,n,i):this.renderLineWaveform(t,e,n,i)}},o.prototype.renderSingleCanvas=function(t,e,n,i,r,o,s){var a=this.getPixelRatio(),u=document.createElement("canvas");u.width=Math.round(n*a),u.height=Math.round(i*a),u.style.width="".concat(n,"px"),u.style.height="".concat(i,"px"),u.style.left="".concat(Math.round(r),"px"),o.appendChild(u);var c=u.getContext("2d");if(this.renderWaveform(t,e,c),u.width>0&&u.height>0){var l=u.cloneNode(),h=l.getContext("2d");h.drawImage(u,0,0),h.globalCompositeOperation="source-in",h.fillStyle=this.convertColorValues(e.progressColor),h.fillRect(0,0,u.width,u.height),s.appendChild(l)}},o.prototype.renderMultiCanvas=function(t,e,n,i,r,s){var a=this,u=this.getPixelRatio(),c=this.scrollContainer.clientWidth,l=n/u,h=Math.min(o.MAX_CANVAS_WIDTH,c,l),p={};if(e.barWidth||e.barGap){var d=e.barWidth||.5,f=d+(e.barGap||d/2);h%f!=0&&(h=Math.floor(h/f)*f)}var v=function(n){if(!(n<0||n>=m||p[n])){p[n]=!0;var o=n*h,u=Math.min(l-o,h);if(!(u<=0)){var c=t.map((function(t){var e=Math.floor(o/l*t.length),n=Math.floor((o+u)/l*t.length);return t.slice(e,n)}));a.renderSingleCanvas(c,e,u,i,o,r,s)}}},m=Math.ceil(l/h);if(this.isScrollable){var y=this.scrollContainer.scrollLeft/l,g=Math.floor(y*m);v(g-1),v(g),v(g+1),m>1&&(this.unsubscribeOnScroll=this.on("scroll",(function(){var t=a.scrollContainer.scrollLeft,e=Math.floor(t/l*m);Object.keys(p).length>o.MAX_NODES&&(r.innerHTML="",s.innerHTML="",p={}),v(e-1),v(e),v(e+1)})))}else for(var b=0;b<m;b++)v(b)},o.prototype.renderChannel=function(t,e,n,i){var r=e.overlay,o=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}(e,["overlay"]),s=document.createElement("div"),a=this.getHeight(o.height,o.splitChannels);s.style.height="".concat(a,"px"),r&&i>0&&(s.style.marginTop="-".concat(a,"px")),this.canvasWrapper.style.minHeight="".concat(a,"px"),this.canvasWrapper.appendChild(s);var u=s.cloneNode();this.progressWrapper.appendChild(u),this.renderMultiCanvas(t,o,n,a,s,u)},o.prototype.render=function(t){return i(this,void 0,void 0,(function(){var e,i,o,s,a,u,c,l,h,p=this;return r(this,(function(r){if(this.timeouts.forEach((function(t){return t()})),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",null!=this.options.width&&(this.scrollContainer.style.width="number"==typeof this.options.width?"".concat(this.options.width,"px"):this.options.width),e=this.getPixelRatio(),i=this.scrollContainer.clientWidth,o=Math.ceil(t.duration*(this.options.minPxPerSec||0)),this.isScrollable=o>i,s=this.options.fillParent&&!this.isScrollable,a=(s?i:o)*e,this.wrapper.style.width=s?"100%":"".concat(o,"px"),this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor="".concat(this.options.cursorColor||this.options.progressColor),this.cursor.style.width="".concat(this.options.cursorWidth,"px"),this.audioData=t,this.emit("render"),this.options.splitChannels)for(u=0;u<t.numberOfChannels;u++)c=n(n({},this.options),null===(h=this.options.splitChannels)||void 0===h?void 0:h[u]),this.renderChannel([t.getChannelData(u)],c,a,u);else l=[t.getChannelData(0)],t.numberOfChannels>1&&l.push(t.getChannelData(1)),this.renderChannel(l,this.options,a,0);return Promise.resolve().then((function(){return p.emit("rendered")})),[2]}))}))},o.prototype.reRender=function(){var t;if(null===(t=this.unsubscribeOnScroll)||void 0===t||t.call(this),delete this.unsubscribeOnScroll,this.audioData){var e=this.scrollContainer.scrollWidth,n=this.progressWrapper.getBoundingClientRect().right;if(this.render(this.audioData),this.isScrollable&&e!==this.scrollContainer.scrollWidth){var i=this.progressWrapper.getBoundingClientRect().right-n;i=(i*=2)<0?Math.floor(i):Math.ceil(i),i/=2,this.scrollContainer.scrollLeft+=i}}},o.prototype.zoom=function(t){this.options.minPxPerSec=t,this.reRender()},o.prototype.scrollIntoView=function(t,e){void 0===e&&(e=!1);var n=this.scrollContainer,i=n.scrollLeft,r=n.scrollWidth,o=n.clientWidth,s=t*r,a=i,u=i+o,c=o/2;if(this.isDragging){s+30>u?this.scrollContainer.scrollLeft+=30:s-30<a&&(this.scrollContainer.scrollLeft-=30)}else{(s<a||s>u)&&(this.scrollContainer.scrollLeft=s-(this.options.autoCenter?c:0));var l=s-i-c;e&&this.options.autoCenter&&l>0&&(this.scrollContainer.scrollLeft+=Math.min(l,10))}var h=this.scrollContainer.scrollLeft,p=h/r,d=(h+o)/r;this.emit("scroll",p,d,h,h+o)},o.prototype.renderProgress=function(t,e){if(!isNaN(t)){var n=100*t;this.canvasWrapper.style.clipPath="polygon(".concat(n,"% 0, 100% 0, 100% 100%, ").concat(n,"% 100%)"),this.progressWrapper.style.width="".concat(n,"%"),this.cursor.style.left="".concat(n,"%"),this.cursor.style.transform="translateX(-".concat(100===Math.round(n)?this.options.cursorWidth:0,"px)"),this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(t,e)}},o.prototype.exportImage=function(t,e,n){return i(this,void 0,void 0,(function(){var i,o;return r(this,(function(r){if(!(i=this.canvasWrapper.querySelectorAll("canvas")).length)throw new Error("No waveform data");return"dataURL"===n?(o=Array.from(i).map((function(n){return n.toDataURL(t,e)})),[2,Promise.resolve(o)]):[2,Promise.all(Array.from(i).map((function(n){return new Promise((function(i,r){n.toBlob((function(t){t?i(t):r(new Error("Could not export image"))}),t,e)}))})))]}))}))},o.MAX_CANVAS_WIDTH=8e3,o.MAX_NODES=10,o}(o),f=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.unsubscribe=function(){},e}return e(n,t),n.prototype.start=function(){var t=this;this.unsubscribe=this.on("tick",(function(){requestAnimationFrame((function(){t.emit("tick")}))})),this.emit("tick")},n.prototype.stop=function(){this.unsubscribe()},n.prototype.destroy=function(){this.unsubscribe()},n}(o),v=function(t){function n(e){void 0===e&&(e=new AudioContext);var n=t.call(this)||this;return n.bufferNode=null,n.playStartTime=0,n.playedDuration=0,n._muted=!1,n._playbackRate=1,n._duration=void 0,n.buffer=null,n.currentSrc="",n.paused=!0,n.crossOrigin=null,n.seeking=!1,n.autoplay=!1,n.addEventListener=n.on,n.removeEventListener=n.un,n.audioContext=e,n.gainNode=n.audioContext.createGain(),n.gainNode.connect(n.audioContext.destination),n}return e(n,t),n.prototype.load=function(){return i(this,void 0,void 0,(function(){return r(this,(function(t){return[2]}))}))},Object.defineProperty(n.prototype,"src",{get:function(){return this.currentSrc},set:function(t){var e=this;if(this.currentSrc=t,this._duration=void 0,!t)return this.buffer=null,void this.emit("emptied");fetch(t).then((function(e){if(e.status>=400)throw new Error("Failed to fetch ".concat(t,": ").concat(e.status," (").concat(e.statusText,")"));return e.arrayBuffer()})).then((function(n){return e.currentSrc!==t?null:e.audioContext.decodeAudioData(n)})).then((function(n){e.currentSrc===t&&(e.buffer=n,e.emit("loadedmetadata"),e.emit("canplay"),e.autoplay&&e.play())}))},enumerable:!1,configurable:!0}),n.prototype._play=function(){var t,e=this;if(this.paused){this.paused=!1,null===(t=this.bufferNode)||void 0===t||t.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);var n=this.playedDuration*this._playbackRate;n>=this.duration&&(n=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,n),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=function(){e.currentTime>=e.duration&&(e.pause(),e.emit("ended"))}}},n.prototype._pause=function(){var t;this.paused=!0,null===(t=this.bufferNode)||void 0===t||t.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime},n.prototype.play=function(){return i(this,void 0,void 0,(function(){return r(this,(function(t){return this.paused?(this._play(),this.emit("play"),[2]):[2]}))}))},n.prototype.pause=function(){this.paused||(this._pause(),this.emit("pause"))},n.prototype.stopAt=function(t){var e,n,i=this,r=t-this.currentTime;null===(e=this.bufferNode)||void 0===e||e.stop(this.audioContext.currentTime+r),null===(n=this.bufferNode)||void 0===n||n.addEventListener("ended",(function(){i.bufferNode=null,i.pause()}),{once:!0})},n.prototype.setSinkId=function(t){return i(this,void 0,void 0,(function(){return r(this,(function(e){return[2,this.audioContext.setSinkId(t)]}))}))},Object.defineProperty(n.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this.bufferNode&&(this.bufferNode.playbackRate.value=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentTime",{get:function(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate},set:function(t){var e=!this.paused;e&&this._pause(),this.playedDuration=t/this._playbackRate,e&&this._play(),this.emit("seeking"),this.emit("timeupdate")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){var t,e;return null!==(t=this._duration)&&void 0!==t?t:(null===(e=this.buffer)||void 0===e?void 0:e.duration)||0},set:function(t){this._duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"volume",{get:function(){return this.gainNode.gain.value},set:function(t){this.gainNode.gain.value=t,this.emit("volumechange")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted!==t&&(this._muted=t,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))},enumerable:!1,configurable:!0}),n.prototype.canPlayType=function(t){return/^(audio|video)\//.test(t)},n.prototype.getGainNode=function(){return this.gainNode},n.prototype.getChannelData=function(){var t=[];if(!this.buffer)return t;for(var e=this.buffer.numberOfChannels,n=0;n<e;n++)t.push(this.buffer.getChannelData(n));return t},n}(o),m={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3},y=function(t){function n(e){var n=this,i=e.media||("WebAudio"===e.backend?new v:void 0);(n=t.call(this,{media:i,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate})||this).plugins=[],n.decodedData=null,n.subscriptions=[],n.mediaSubscriptions=[],n.abortController=null,n.options=Object.assign({},m,e),n.timer=new f;var r=i?void 0:n.getMediaElement();n.renderer=new d(n.options,r),n.initPlayerEvents(),n.initRendererEvents(),n.initTimerEvents(),n.initPlugins();var o=n.options.url||n.getSrc()||"";return Promise.resolve().then((function(){n.emit("init");var t=n.options,e=t.peaks,i=t.duration;(o||e&&i)&&n.load(o,e,i).catch((function(){return null}))})),n}return e(n,t),n.create=function(t){return new n(t)},n.prototype.updateProgress=function(t){return void 0===t&&(t=this.getCurrentTime()),this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),t},n.prototype.initTimerEvents=function(){var t=this;this.subscriptions.push(this.timer.on("tick",(function(){if(!t.isSeeking()){var e=t.updateProgress();t.emit("timeupdate",e),t.emit("audioprocess",e)}})))},n.prototype.initPlayerEvents=function(){var t=this;this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",(function(){var e=t.updateProgress();t.emit("timeupdate",e)})),this.onMediaEvent("play",(function(){t.emit("play"),t.timer.start()})),this.onMediaEvent("pause",(function(){t.emit("pause"),t.timer.stop()})),this.onMediaEvent("emptied",(function(){t.timer.stop()})),this.onMediaEvent("ended",(function(){t.emit("finish")})),this.onMediaEvent("seeking",(function(){t.emit("seeking",t.getCurrentTime())})),this.onMediaEvent("error",(function(e){t.emit("error",e.error)})))},n.prototype.initRendererEvents=function(){var t,e=this;this.subscriptions.push(this.renderer.on("click",(function(t,n){e.options.interact&&(e.seekTo(t),e.emit("interaction",t*e.getDuration()),e.emit("click",t,n))})),this.renderer.on("dblclick",(function(t,n){e.emit("dblclick",t,n)})),this.renderer.on("scroll",(function(t,n,i,r){var o=e.getDuration();e.emit("scroll",t*o,n*o,i,r)})),this.renderer.on("render",(function(){e.emit("redraw")})),this.renderer.on("rendered",(function(){e.emit("redrawcomplete")})),this.renderer.on("dragstart",(function(t){e.emit("dragstart",t)})),this.renderer.on("dragend",(function(t){e.emit("dragend",t)}))),this.subscriptions.push(this.renderer.on("drag",(function(n){var i;e.options.interact&&(e.renderer.renderProgress(n),clearTimeout(t),e.isPlaying()?i=0:!0===e.options.dragToSeek?i=200:"object"==typeof e.options.dragToSeek&&void 0!==e.options.dragToSeek&&(i=e.options.dragToSeek.debounceTime),t=setTimeout((function(){e.seekTo(n)}),i),e.emit("interaction",n*e.getDuration()),e.emit("drag",n))})))},n.prototype.initPlugins=function(){var t,e=this;(null===(t=this.options.plugins)||void 0===t?void 0:t.length)&&this.options.plugins.forEach((function(t){e.registerPlugin(t)}))},n.prototype.unsubscribePlayerEvents=function(){this.mediaSubscriptions.forEach((function(t){return t()})),this.mediaSubscriptions=[]},n.prototype.setOptions=function(t){this.options=Object.assign({},this.options,t),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),null!=t.mediaControls&&(this.getMediaElement().controls=t.mediaControls)},n.prototype.registerPlugin=function(t){var e=this;return t._init(this),this.plugins.push(t),this.subscriptions.push(t.once("destroy",(function(){e.plugins=e.plugins.filter((function(e){return e!==t}))}))),t},n.prototype.getWrapper=function(){return this.renderer.getWrapper()},n.prototype.getWidth=function(){return this.renderer.getWidth()},n.prototype.getScroll=function(){return this.renderer.getScroll()},n.prototype.setScroll=function(t){return this.renderer.setScroll(t)},n.prototype.setScrollTime=function(t){var e=t/this.getDuration();this.renderer.setScrollPercentage(e)},n.prototype.getActivePlugins=function(){return this.plugins},n.prototype.loadAudio=function(t,e,n,o){return i(this,void 0,void 0,(function(){var i,s,u,c,l,p,d,f=this;return r(this,(function(r){switch(r.label){case 0:return this.emit("load",t),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,e||n?[3,2]:(i=this.options.fetchParams||{},window.AbortController&&!i.signal&&(this.abortController=new AbortController,i.signal=null===(d=this.abortController)||void 0===d?void 0:d.signal),s=function(t){return f.emit("loading",t)},[4,h.fetchBlob(t,s,i)]);case 1:e=r.sent(),r.label=2;case 2:return this.setSrc(t,e),[4,new Promise((function(t){var e=o||f.getDuration();e?t(e):f.mediaSubscriptions.push(f.onMediaEvent("loadedmetadata",(function(){return t(f.getDuration())}),{once:!0}))}))];case 3:return u=r.sent(),t||e||(c=this.getMediaElement())instanceof v&&(c.duration=u),n?(this.decodedData=a.createBuffer(n,u||0),[3,7]):[3,4];case 4:return e?[4,e.arrayBuffer()]:[3,7];case 5:return l=r.sent(),p=this,[4,a.decode(l,this.options.sampleRate)];case 6:p.decodedData=r.sent(),r.label=7;case 7:return this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration()),[2]}}))}))},n.prototype.load=function(t,e,n){return i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.loadAudio(t,void 0,e,n)];case 1:return[2,r.sent()];case 2:throw i=r.sent(),this.emit("error",i),i;case 3:return[2]}}))}))},n.prototype.loadBlob=function(t,e,n){return i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.loadAudio("",t,e,n)];case 1:return[2,r.sent()];case 2:throw i=r.sent(),this.emit("error",i),i;case 3:return[2]}}))}))},n.prototype.zoom=function(t){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)},n.prototype.getDecodedData=function(){return this.decodedData},n.prototype.exportPeaks=function(t){var e=void 0===t?{}:t,n=e.channels,i=void 0===n?2:n,r=e.maxLength,o=void 0===r?8e3:r,s=e.precision,a=void 0===s?1e4:s;if(!this.decodedData)throw new Error("The audio has not been decoded yet");for(var u=Math.min(i,this.decodedData.numberOfChannels),c=[],l=0;l<u;l++){for(var h=this.decodedData.getChannelData(l),p=[],d=h.length/o,f=0;f<o;f++){for(var v=h.slice(Math.floor(f*d),Math.ceil((f+1)*d)),m=0,y=0;y<v.length;y++){var g=v[y];Math.abs(g)>Math.abs(m)&&(m=g)}p.push(Math.round(m*a)/a)}c.push(p)}return c},n.prototype.getDuration=function(){var e=t.prototype.getDuration.call(this)||0;return 0!==e&&e!==1/0||!this.decodedData||(e=this.decodedData.duration),e},n.prototype.toggleInteraction=function(t){this.options.interact=t},n.prototype.setTime=function(e){t.prototype.setTime.call(this,e),this.updateProgress(e),this.emit("timeupdate",e)},n.prototype.seekTo=function(t){var e=this.getDuration()*t;this.setTime(e)},n.prototype.playPause=function(){return i(this,void 0,void 0,(function(){return r(this,(function(t){return[2,this.isPlaying()?this.pause():this.play()]}))}))},n.prototype.stop=function(){this.pause(),this.setTime(0)},n.prototype.skip=function(t){this.setTime(this.getCurrentTime()+t)},n.prototype.empty=function(){this.load("",[[0]],.001)},n.prototype.setMediaElement=function(e){this.unsubscribePlayerEvents(),t.prototype.setMediaElement.call(this,e),this.initPlayerEvents()},n.prototype.exportImage=function(){return i(this,arguments,void 0,(function(t,e,n){return void 0===t&&(t="image/png"),void 0===e&&(e=1),void 0===n&&(n="dataURL"),r(this,(function(i){return[2,this.renderer.exportImage(t,e,n)]}))}))},n.prototype.destroy=function(){var e;this.emit("destroy"),null===(e=this.abortController)||void 0===e||e.abort(),this.plugins.forEach((function(t){return t.destroy()})),this.subscriptions.forEach((function(t){return t()})),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),t.prototype.destroy.call(this)},n.BasePlugin=s,n.dom=l,n}(p);module.exports=y;
